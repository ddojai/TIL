# 09장 넷플릭스 유레카와 리본을 사용한 서비스 검색

## DNS 기반 서비스 검색의 문제
- 새 마이크로서비스 인스턴스를 시작하고 라운드 로빈 방식 DNS를 이용해 검색하면 안되는 이유
  - 마이크로서비스 인스턴스의 DNS 이름이 같기만 하면 DNS 서버는 이를 사용 가능한 인스턴스의 IP 주소 목록으로 분석한다.
  - 따라서 클라이언트는 라운드 로빈 방식으로 서비스 인스턴스를 호출할 수 있다.
- DNS 클라이언트는 보통 리졸브된 IP 주소를 캐시하며, DNS 이름에 대응되는 IP 주소가 여러 개인 경우에는 동작하는 첫 번째 IP 주소를 계속 사용한다.
- DNS 서버와 DNS 프로토콜은 동적으로 변하는 마이크로서비스 인스턴스를 처리하는 데 적합하지 않으며, 실무 관점에서도 DNS에 기반한 서비스 검색이 그리 매력적이지 않다.

## 서비스 검색의 문제
- 다음 사항을 고려해 마이크로서비스 인스턴스를 추적해야 한다.
  - 언제든지 새로운 인스턴스가 시작될 수 있다.
  - 언제든지 기존 인스턴스가 응답하지 않을 수 있으며, 결국에는 중단될 수 있다.
  - 실패한 인스턴스 중 일부는 얼마 후에 정상 상태로 돌아와서 다시 트래픽을 수신하지만 그렇지 못하는 인스턴스도 있다.
  - 실패해서 복구되지 못한 인스턴스는 서비스 레지스트리에서 제거해야 한다.
  - 일부 마이크로서비스 인스턴스는 시작하는 데 시간이 걸릴 수 있다. 즉 HTTP 요청을 수신한다고 해서 즉시 해당 인스턴스로 트래픽을 라우팅할 수 있는 건 아니다.
  - 언제든디 의도하지 않은 네트워크 파티셔닝과 그 밖의 네트워크 관련 오류가 발생할 수 있다.

## 넷플릭스 유레카를 이용한 서비스 검색
- 유레카는 클라이언트 측 서비스 검색을 구현한다.
- 클라이언트는 사용 가능한 서비스 인스턴스의 정보를 얻고자 검색 서비스 유레카와 통신하는 소프트웨어를 실행
- 스프링 부트는 시작하는 동안 DiscoveryClient 인터페이스 구현을 자동으로 찾는다.
- 연결하는 검색 서버에 맞는 의존성을 추가해야 한다.
  - 유레카를 검색 서버로 사용하는 서비스라면 spring-cloud-starter-netflic-eureka-client 의존성을 추가
- 스프링 클라우드는 로드 밸런서를 통해 검색 서비스에 등록된 인스턴스로 요청을 보내는 방법을 추상화한 LoadBalancerClient 인터페이스를 제공한다.