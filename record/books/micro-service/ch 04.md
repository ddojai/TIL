## 04장 도커를 사용한 마이크로서비스 배포

### 도커에서 자바를 실행할 때의 문제
- 예전에는 자바가 리눅스 cgroup으로 지정한 자원 할당량을 무시했기 때문에 도커와 잘 맞이 않았음.
- 자바는 컨테이너에 허용된 메모리를 JVM에 할당하는 게 아니라 도커 호스트의 전체 메모리를 할당.
- 컨테이너에 허용된 CPU 코어만 JVM에 할당하는 게 아니라 도커 호스트의 스레드 풀 등의 CPU 관련 전체 자원을 컨테이너의 JVM에 할당했다.
- 자바는 자바 SE 9 버전부터 조금씩 도커를 지원하기 시작했으며, 이후에 나온 자바 SE 8 버전에도 이를 반영했다.
- 자바 10 에서는 CPU 및 메모리 제약 조건이 크게 개선됐다.

### 도커 없이 자바 커맨드 실행
``` cmd
# cpu 코어 수 확인
echo 'Runtime.getRuntime().availableProcessors()' | jshell -q

# 힙에 할당 가능한 최대 메모리
java -XX:+PrintFlagsFinal -version | grep MaxHeapSize

# Xmx 매개 변수로 JVM의 최대 힙 크기를 지정하지 않으면 JVM은 사용 가능한 메모리의 1/4을 최대 힙 크기로 설정.
java -Xmx200m -XX:+PrintFlagsFinal -version | grep MaxHeapSize
```

### 도커에서 자바 커맨드 실행